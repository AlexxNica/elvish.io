#!/bin/sh
in=$1
out=$2
opts=

has() {
    head -n1 $in | grep "$@" >/dev/null
}

has toc && {
    opts="$opts --toc --template=toc-and-body"
}
has number-sections && {
    opts="$opts --number-sections"
}

# Generate <img> tags for screenshots
sed 's|$screenshot \([^ "]*\) \([^"]*\)|<img src="/assets/\1.png" srcset="/assets/\1-1.5x.png 1.5x, /assets/\1-2x.png 2x" class="macos" alt="\2">|g' $1 |
md-highlighter |
  pandoc -f markdown_github-hard_line_breaks \
      --data-dir=./pandoc-data -o $2 $opts
